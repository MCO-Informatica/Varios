#INCLUDE "protheus.ch"

/*/

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLINCIFAT12บ Autor ณ Rodrigo Demetrios  บ Data ณ  07/07/06   บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDescricao ณRelatorio de Pedidos Entregues fora da data                 บฑฑ
ฑฑบ          ณ                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ AP6 IDE                                                    บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
/*/

User Function LIFAT12()


//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณ Declaracao de Variaveis                                             ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู

//Local cInd
Local cDesc1         := "Este programa tem como objetivo imprimir relatorio "
Local cDesc2         := "de acordo com os parametros informados pelo usuario."
Local cDesc3         := "Pedidos Entregues fora da data"
Local cPict          := ""
Local titulo         := "Pedidos Entregues Fora da Data"
Local nLin           := 80

Local Cabec1       := " Pedido   Data      Produto          Descri็ใo do Produto            Cliente   Nome do Cliente                      Quantidade       Quantidade       Valor       Entrega     Nota      Data         Dias"
Local Cabec2       := "          Emissao                                                                                                   Vendida          Entregue         C/ IPI      Prevista    Fiscal    Realizada    Atraso"
Local imprime      := .T.
Local aOrd := {}


Private lEnd         := .F.
Private lAbortPrint  := .F.
Private CbTxt        := ""
Private limite           := 220
Private tamanho          := "G"
Private nomeprog         := "LIFAT12" // Coloque aqui o nome do programa para impressao no cabecalho
Private nTipo            := 18
Private aReturn          := { "Zebrado", 1, "Administracao", 2, 2, 1, "", 1}
Private nLastKey        := 0
Private cPerg       := "LIFA12"
Private cbtxt      := Space(10)
Private cbcont     := 00
Private CONTFL     := 01
Private m_pag      := 01
Private wnrel      := "LIFAT12" // Coloque aqui o nome do arquivo usado para impressao em disco

Private cString := "SC5"

pergunte(cPerg,.F.)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณ Monta a interface padrao com o usuario...                           ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู

wnrel := SetPrint(cString,NomeProg,cPerg,@titulo,cDesc1,cDesc2,cDesc3,.T.,aOrd,.T.,Tamanho,,.T.)

If nLastKey == 27
	Return
Endif

SetDefault(aReturn,cString)

If nLastKey == 27
	Return
Endif

nTipo := If(aReturn[4]==1,15,18)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณ Processamento. RPTSTATUS monta janela com a regua de processamento. ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู

RptStatus({|| RunReport(Cabec1,Cabec2,Titulo,nLin) },Titulo)
Return

/*/

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบFuno    ณRUNREPORT บ Autor ณ AP6 IDE            บ Data ณ  07/07/06   บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDescrio ณ Funcao auxiliar chamada pela RPTSTATUS. A funcao RPTSTATUS บฑฑ
ฑฑบ          ณ monta a janela com a regua de processamento.               บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Programa principal                                         บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
/*/

Static Function RunReport(Cabec1,Cabec2,Titulo,nLin)

Local nOrdem

cdatade := mv_par01
cdataate := mv_par02
centde := mv_par03
centate := mv_par04

dbSelectArea("SC6")
//dbSetOrder(1)
cFilTrab   := CriaTrab("",.F.)
cCondicao  := "C6_FILIAL=='"+xFilial("SC6")+"'.And."
cCondicao  += "Dtos(C6_ENTREG)>='"+Dtos(MV_PAR03)+"'.And.Dtos(C6_ENTREG)<='"+Dtos(MV_PAR04)+"'"
IndRegua("SC6",cFilTrab,"C6_FILIAL+C6_CLI",,cCondicao,"Filtrando")    // "Selecionando Registros..."

NTOTGER := 0  //TOTAL GERAL SEM IPI
NTOTGIPI := 0 //TOTAL DO IPI
NTOTGCIPI := 0//TOTAL GERAL COM IPI

DbGoTop()
SetRegua(RecCount())

While !Eof()
	IncRegua()
	
	NTOTPED := 0 //TOTAL PEDIDO SEM IPI
	NTOTIPI := 0 //TOTAL IPI
	NTOTCIPI:= 0 //TOTAL PEDIDO COM IPI
	
	_cCli := sc6->c6_cli
_NCONTOLE := 0	
	While !EOF() .AND. SC6->C6_CLI == _CCLI
		
		IF (C6_TES $ '501/502/504/506/507/528/534/535/536/541/542/543/545/547/552/554/555/557/559/561/562/564') //.AND. C6_BLQ <> 'R ' .AND. dtos(C6_ENTREG) < dtos(C6_DATFAT)
			If lAbortPrint
				@nLin,00 PSAY "*** CANCELADO PELO OPERADOR ***"
				Exit
			Endif
			
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
			//ณ Impressao do cabecalho do relatorio. . .                            ณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
			
			If nLin > 55 // Salto de Pแgina. Neste caso o formulario tem 55 linhas...
				Cabec(Titulo,Cabec1,Cabec2,NomeProg,Tamanho,nTipo)
				nLin := 10
			Endif
			
			dbSelectArea("SB1")
			dbSetOrder(1)
			dbseek(xfilial("SB1") + SC6->C6_PRODUTO )
			
			dbSelectArea("SA1")
			dbSetOrder(1)
			dbseek(xfilial("SA1") + SC6->C6_CLI)
			
			dbSelectArea("SC5")
			dbSetOrder(1)
			dbseek(xfilial("SC5") + SC6->C6_NUM)
			
			// Pedido   Data      Produto          Descri็ใo do Produto             Cliente   Nome do Cliente                  Valor            Valor            Valor            Entrega     Nota      Data         Dias
			//          Emissao                                                                                "  1            S/ IPI           IPI              C/ IPI           Prevista    Fiscal    Realizada    Atraso
			// 123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
			//          1         2         3         4         5         6         7         8         9         0         1         2         3         4         5         6        17        18        19        20         21       22

			@nLin,01 PSAY SC6->C6_NUM                                                                                                                                           //99/99/99    999999    99/99/99     999
			@nLin,10 PSAY SC5->C5_EMISSAO
			@nLin,20 PSAY SC6->C6_PRODUTO + " - " + SB1->B1_DESC
			@nLin,70 PSAY SC6->C6_CLI + " - " + SUBSTR(SA1->A1_NOME,1,20)
			@nLin,113 PSAY  SC6->C6_QTDVEN PICTURE "@E 99,999,999"
			//@nLin,113 PSAY SC6->C6_VALOR PICTURE "@E 99,999,999.99"
			nValIPI := ((SC6->C6_VALOR * SB1->B1_IPI)/100)
			@nLin,130 PSAY SC6->C6_QTDENT PICTURE "@E 99,999,999"
			//@nLin,130 PSAY nValIPI PICTURE "@E 99,999,999.99"
			nValTOTAL := nValIPI + SC6->C6_VALOR
			@nLin,147 PSAY nValTOTAL PICTURE "@E 99,999,999.99"
			@nLin,164 PSAY SC6->C6_ENTREG
			@nLin,176 PSAY SC6->C6_NOTA
			@nLin,186 PSAY SC6->C6_DATFAT
			@nLin,199 PSAY SC6->C6_DATFAT - SC6->C6_ENTREG
			
			NTOTPED := NTOTPED + SC6->C6_QTDVEN    //QUANTIDADE VENDIDA
			NTOTIPI := NTOTIPI + SC6->C6_QTDENT   //QUANTIDADE ENTREGUE
			NTOTCIPI:= NTOTCIPI + nValTOTAL   //VALOR COM IPI
			nLin := nLin + 1 // Avanca a linha de impressao
			_NCONTOLE := 1	

			dbSelectArea("SC6")
		ENDIF
		dbSkip() // Avanca o ponteiro do registro no arquivo
	EndDo
    IF _NCONTOLE == 1
	@nLin,000 PSAY "TOTAL CLIENTE" + " --------------------------------------------------> "
	@nLin,112 PSAY NTOTPED PICTURE "@E 99,999,999"
	@nLin,129 PSAY NTOTIPI PICTURE "@E 99,999,999"
	@nLin,146 PSAY NTOTCIPI PICTURE "@E 99,999,999.99"
	
	nTotGER  +=  NTOTPED
	NTOTGIPI  += NTOTIPI
	NTOTGCIPI += NTOTCIPI
	nLin := nLin + 1
	ENDIF
	dbSelectArea("SC6")
ENdDo

nLin := nLin + 1

@nLin,000 PSAY "TOTAL GERAL" + " --------------------------------------------------> "
@nLin,112 PSAY nTotGER PICTURE "@E 99,999,999"
@nLin,129 PSAY NTOTGIPI PICTURE "@E 99,999,999"
@nLin,146 PSAY NTOTGCIPI PICTURE "@E 99,999,999.99"


dbSelectArea("SC6")
retindex()

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณ Finaliza a execucao do relatorio...                                 ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู

SET DEVICE TO SCREEN

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณ Se impressao em disco, chama o gerenciador de impressao...          ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู

If aReturn[5]==1
	dbCommitAll()
	SET PRINTER TO
	OurSpool(wnrel)
Endif

MS_FLUSH()

Return

