#INCLUDE "rwmake.CH"
#INCLUDE "PROTHEUS.CH"

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Programa   	LS_AJCTB
// Autor 		Alexandre Dalpiaz
// Data 		23/07/2013
// Descricao  	AJUSTA TABELAS DA CONTABILIDADE APÓS REINICIALIZAÇÃO DOS SISTEMA
// Uso         	LaSelva
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
User Function LS_AJCTB()
///////////////////////

_aTabs := &(GetMv('LS_TABSCTB')) 	//{'CT4','CT9','CTA','CTB','CTD','CTH','CTI','CTL','CTS','CTV','CTX','CTY','CTW','CTZ'}

For _nI := 1 to len(_aTabs)
	If TcCanOpen(RetSqlName(_aTabs[_nI] ))
		_cQuery := "SELECT COUNT(*) QUANT FROM " + RetSqlName(_aTabs[_nI]) + " (NOLOCK)"
		DbUseArea(.T., "TOPCONN", TCGenQry(,,_cQuery), '_CTB', .F., .T.)
		_nQuant := _CTB->QUANT
		DbCloseArea()
		If _nQuant == 0
			TCSqlExec("DROP TABLE " + RetSqlName(_aTabs[_nI]))
		EndIf
	EndIf
Next


MsgAlert('Tabelas ajustadas')

Return()
