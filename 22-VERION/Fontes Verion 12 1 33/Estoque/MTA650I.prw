#Include "Protheus.ch"
#Include "TopConn.ch"


User Function MTA650I()

Local cSql := ""

cSql := "UPDATE SB2010 SET B2_VATU1 = ROUND(B2_QATU * B2_CM1,8),B2_VATU2 = ROUND(B2_QATU * B2_CM2,8),B2_VATU3 = ROUND(B2_QATU * B2_CM3,8),B2_VATU4 = ROUND(B2_QATU * B2_CM4,8),B2_VATU5 = ROUND(B2_QATU * B2_CM5,8) WHERE (B2_COD IN (SELECT D4_COD FROM SD4010 WHERE D4_OP like '"+SC2->C2_NUM+"%' ) OR B2_COD IN (SELECT C2_PRODUTO FROM SC2010 WHERE C2_NUM LIKE '"+SC2->C2_NUM+"%')) AND D_E_L_E_T_=' ' AND B2_CM1 > 0 "
TcSqlExec(cSql)

cSql := "UPDATE SB9010 SET B9_VINI1 = ROUND(B9_QINI * B9_CM2,8),B9_VINI2 = ROUND(B9_QINI * B9_CM2,8),B9_VINI3 = ROUND(B9_QINI * B9_CM3,8),B9_VINI4 = ROUND(B9_QINI * B9_CM4,8),B9_VINI5 = ROUND(B9_QINI * B9_CM5,8) WHERE (B9_COD IN (SELECT D4_COD FROM SD4010 WHERE D4_OP like '"+SC2->C2_NUM+"%' ) OR B9_COD IN (SELECT C2_PRODUTO FROM SC2010 WHERE C2_NUM LIKE '"+SC2->C2_NUM+"%')) AND D_E_L_E_T_=' ' "
TcSqlExec(cSql)

cSql := "UPDATE SB9010 SET B9_QINI = 0, B9_VINI1 = 0, B9_VINI2 = 0, B9_VINI3 = 0, B9_VINI4 = 0, B9_VINI5 = 0 WHERE (B9_COD IN (SELECT D4_COD FROM SD4010 WHERE D4_OP like '"+SC2->C2_NUM+"%' ) OR B9_COD IN (SELECT C2_PRODUTO FROM SC2010 WHERE C2_NUM LIKE '"+SC2->C2_NUM+"%')) AND D_E_L_E_T_=' ' AND B9_QINI < 0 "
TcSqlExec(cSql)

cSql := "UPDATE SB2010 SET B2_VATU1 = 0, B2_VATU2 = 0, B2_VATU3 = 0, B2_VATU4 = 0, B2_VATU5 = 0, B2_CM1 = 0, B2_CMFIM1 = 0, B2_CM2 = 0, B2_CM3 = 0, B2_CM4 = 0, B2_CM5 = 0 WHERE (B2_CM1 < 0 OR B2_VATU1 < 0 OR B2_VATU2 < 0 OR B2_VATU1 > 99999999) AND (B2_COD IN (SELECT D4_COD FROM SD4010 WHERE D4_OP like '"+SC2->C2_NUM+"%' ) OR B2_COD IN (SELECT C2_PRODUTO FROM SC2010 WHERE C2_NUM LIKE '"+SC2->C2_NUM+"%')) AND D_E_L_E_T_=' ' "
TcSqlExec(cSql)


Return
