#include 'Protheus.ch'
#INCLUDE "TopConn.ch"

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณNOVO8     บAutor  ณMicrosiga           บ Data ณ  04/27/12   บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณ                                                            บฑฑ
ฑฑบ          ณ                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ AP                                                         บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/

User Function MT650OPPV()  
 
LOCAL _AAREA := GETAREA()

If cEmpAnt <> '01'
	Return
Endif

// AQUI INCLUSAO DA ROTINA QUE IRม GRAVAR OS DADOS DO LOTE NA TABELA DE EMPENHO.
dbselectarea("SD4")
DBSETORDER(2)    
IF DBSEEK(XFILIAL("SD4") + SD4->D4_OP )
	DO WHILE !EOF() .AND. SUBSTR(SD4->D4_OP,1,9) == ALLTRIM(SC2->C2_NUM+SC2->C2_ITEM+SC2->C2_SEQUEN)
		if SD4->D4_COD == SC2->C2_PRODUTO
			IF EMPTY(SD4->D4_LOTECTL)
				RECLOCK("SD4",.F.)
				SD4->D4_LOTECTL := SUBSTR(SD4->D4_OP,1,8)
				SD4->(MSUNLOCK())
			ENDIF   
		ENDIF
		DBSELECTAREA("SD4")
		DBSKIP()
	ENDDO
ENDIF
// FIM DA ROTINA

RESTAREA(_AAREA)

Return


