/*
SQL PITERPAN

As solicitações SEMPRE COM FILTRO POR PERÍODO (Data De e Data Até) de cada contexto, mas na POSIÇÃO ATUAL (Tempo Real);

FATURAMENTO: Contendo dados de cada fatura emitida (Empresa, Data de Faturamento, Nome do Cliente/Apelido, Valor Bruto Faturado, Impostos, etc. - O que for possível obter);

PEDIDOS REGISTRADOS: Contendo dados de cada pedido (Empresa, Data do Pedido, Data do Registro do Pedido, Cliente/Apelido, Produtos e Valores Brutos); 

PEDIDOS EM ABERTO NA CARTEIRA: Considerar também saldos dos atendidos parcialmente, contendo dados de cada pedido (Empresa, Data do Pedido, Data do Registro do Pedido, Cliente/Apelido, Produtos e Valores Brutos);

CONTAS A PAGAR: Contendo dados do compromisso (Empresa, Datas de Emissão e Vencimento, Destinatário, Valor a Pagar, Pedido/Serviço, status de pago ou não, Data de Pagamento e Forma de Liquidação*);


CONTAS A RECEBER: Contendo dados do Vencimentário (Empresa, Datas de Emissão e Vencimento, Cliente/Apelido, Valor a Receber, Pedido, NF, status de recebido ou não, Data do Recebimento e Forma de Liquidação*).
(*) Forma de Liquidação: Detalhes de por onde entrou/saiu o recurso financeiro (Banco, Caixa, etc.)                                                                                                         


*/


/* FATURAMENTO */
SELECT 
F2_FILIAL FILIAL, 
CONVERT(NVARCHAR,CAST(F2_EMISSAO AS DATE),103) EMISSAO,
F2_SERIE SERIE,
F2_DOC NOTA,
F2_CLIENTE+'-'+F2_LOJA COD_CLIENTE,
A1_NOME CLIENTE,
F2_VALBRUT VALOR_BRUTO,
F2_VALICM ICMS,
F2_VALIPI IPI,
F2_VALIMP4+F2_VALIMP5+F2_VALIMP6 PCC
FROM SF2010
JOIN SA1010 ON A1_COD = F2_CLIENTE AND A1_LOJA = F2_LOJA AND SA1010.D_E_L_E_T_ =' '
WHERE F2_EMISSAO BETWEEN '20211201'AND'20211231'
AND SF2010.D_E_L_E_T_ =' '
ORDER BY 1,2,3,4;



/* PEDIDOS REGISTRADOS*/
SELECT 
C6_FILIAL FILIAL,
CONVERT(NVARCHAR,CAST(C6_EMISSAO AS DATE),103) EMISSAO,
CONVERT(NVARCHAR,CAST(C6_ENTREG AS DATE),103) ENTREGA,
C6_NUM PEDIDO,
C6_CLI+'-'+C6_LOJA COD_CLIENTE,
A1_NOME CLIENTE,
C6_PRODUTO COD_PRODUTO,
B1_DESC PRODUTO,
C6_VALOR VALOR,
C6_NOTA NOTA
FROM SC6010
JOIN SB1010 ON B1_COD = C6_PRODUTO AND SB1010.D_E_L_E_T_ =' '
JOIN SA1010 ON C6_CLI = A1_COD AND C6_LOJA = A1_LOJA AND SA1010.D_E_L_E_T_ =' '
WHERE SC6010.D_E_L_E_T_ =' '
AND C6_EMISSAO BETWEEN '20211201'AND'20211231'
ORDER BY 1,2,4;


/* PEDIDOS EM ABERTO */
SELECT 
C6_FILIAL FILIAL,
CONVERT(NVARCHAR,CAST(C6_EMISSAO AS DATE),103) EMISSAO,
CONVERT(NVARCHAR,CAST(C6_ENTREG AS DATE),103) ENTREGA,
C6_NUM PEDIDO,
C6_CLI+'-'+C6_LOJA COD_CLIENTE,
A1_NOME CLIENTE,
C6_PRODUTO COD_PRODUTO,
B1_DESC PRODUTO,
C6_VALOR VALOR,
C6_NOTA NOTA
FROM SC6010
JOIN SB1010 ON B1_COD = C6_PRODUTO AND SB1010.D_E_L_E_T_ =' '
JOIN SA1010 ON C6_CLI = A1_COD AND C6_LOJA = A1_LOJA AND SA1010.D_E_L_E_T_ =' '
WHERE SC6010.D_E_L_E_T_ =' '
AND C6_NOTA = ' '
AND C6_EMISSAO BETWEEN '20211201'AND'20211231'
ORDER BY 1,2,4;


/* TITULOS A PAGAR */
SELECT 
E2_FILIAL FILIAL,
E2_PREFIXO PREFIXO,
E2_NUM TITULO,
E2_PARCELA PARCELA,
CONVERT(NVARCHAR,CAST(E2_EMISSAO AS DATE),103) EMISSAO,
CONVERT(NVARCHAR,CAST(E2_VENCTO AS DATE),103) VENCIMENTO,
SUBSTRING(E2_BAIXA,7,2)+'/'+SUBSTRING(E2_BAIXA,5,2)+'/'+SUBSTRING(E2_BAIXA,1,4) BAIXA,
E2_BCOPAG BANCO_PGTO,
E2_FORNECE+'-'+E2_LOJA COD_FORNECEDOR,
A2_NOME FORNECEDOR,
E2_VALOR VALOR,
E2_SALDO SALDO_ABERTO,
CASE WHEN E2_SALDO > 0 AND E2_BAIXA <> ' ' THEN 'BAIXADO PARCIAL' WHEN E2_SALDO > 0 AND E2_BAIXA = ' ' THEN 'EM ABERTO' ELSE 'PAGO' END STATUS
FROM SE2010 
JOIN SA2010 ON A2_COD = E2_FORNECE AND A2_LOJA = E2_LOJA AND SA2010.D_E_L_E_T_ = ' '
WHERE SE2010.D_E_L_E_T_ =' ' 
AND E2_EMISSAO BETWEEN '20211201'AND'20211231'
ORDER BY 1,5,10,2,3;



/* TITULOS A RECEBER */
SELECT 
E1_FILIAL FILIAL,
E1_PREFIXO PREFIXO,
E1_NUM TITULO,
E1_PARCELA PARCELA,
CONVERT(NVARCHAR,CAST(E1_EMISSAO AS DATE),103) EMISSAO,
CONVERT(NVARCHAR,CAST(E1_VENCTO AS DATE),103) VENCIMENTO,
SUBSTRING(E1_BAIXA,7,2)+'/'+SUBSTRING(E1_BAIXA,5,2)+'/'+SUBSTRING(E1_BAIXA,1,4) BAIXA,
E1_PORTADO BANCO_PGTO,
E1_CLIENTE+'-'+E1_LOJA COD_CLIENTE,
A1_NOME CLIENTE,
E1_PEDIDO PEDIDO,
E1_VALOR VALOR,
E1_SALDO SALDO_ABERTO,
CASE WHEN E1_SALDO > 0 AND E1_BAIXA <> ' ' THEN 'BAIXADO PARCIAL' WHEN E1_SALDO > 0 AND E1_BAIXA = ' ' THEN 'EM ABERTO' ELSE 'PAGO' END STATUS
FROM SE1010 
JOIN SA1010 ON A1_COD = E1_CLIENTE AND A1_LOJA = E1_LOJA AND SA1010.D_E_L_E_T_ = ' '
WHERE SE1010.D_E_L_E_T_ =' ' 
AND E1_EMISSAO BETWEEN '20211201'AND'20211231'
ORDER BY 1,5,10,2,3;
