#Include "Protheus.ch"#Include "rwmake.ch"#INCLUDE "TBICONN.CH"#DEFINE oFont100N	   TFont():New("Arial",, 100,, .T.,,,,, .F., .F.)#DEFINE oFont40N	   TFont():New("Arial",, 40,, .T.,,,,, .F., .F.)#DEFINE oFont20N	   TFont():New("Arial",, 20,, .T.,,,,, .F., .F.)#DEFINE oFont12N	   TFont():New("Arial",, 12,, .T.,,,,, .F., .F.)/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄ¿±±±±³Programa  ³ RFATR101  ³ Autor ³ FELIPE VALENCA          ³ Data ³ 20/01/2012 ³±±±±³          ³          ³       ³                         ³      ³            ³±±±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄ´±±±±³Descricao ³ Impressao Etiquetas                                            ³±±±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±±±³Observacao³ Etiqueta Codigo de Barras                                      ³±±±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±±±³Uso       ³                                                                ³±±±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±±±³             ATUALIZACOES SOFRIDAS DESDE A CONSTRU€AO INICIAL              ³±±±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±±±³Programador   ³  Data  ³              Motivo da Alteracao                  ³±±±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±±±³              ³        ³                                                   ³±±±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/User Function RFATR101()	Private cQuery	Private cDesc			:= ""	Private cClas			:= ""	Private cGrup			:= ""	Private cDim1			:= ""	Private cDim2			:= ""	Private cDim3			:= ""	Private cDim4			:= ""	Private cDim5			:= ""	Private cDim6			:= ""	Private cDim7			:= ""	Private cNome			:= ""	Private aCodBar			:= {}	Private cPerg			:= PadR("RFATR101",Len(SX1->X1_GRUPO))	Private _cNum			:= ""	Private cPedido			:= ""	Private lPassou			:= .F.	Private cFabrica		:= ""	Private nQtdImp			:= 0	Private cCliente		:= ""	Private cEmail			:= ""	Private cCodProd		:= ""	Private cProduto		:= ""	Private cOP				:= ""	Private nQE				:= 0	Private cData			:= "__/__/" + cValTochar(year(dDatabase))	Private nIni			:= 0	Private nIniCB			:= 0	Private cArq			:= ""	//tstmscb()	//Return()		ValidPerg()	If !pergunte(cPerg,.T.)		Return	Endif	nQtdImp		:= Val(MV_PAR10)	cCliente	:= Posicione("SA1",1,xFilial("SA1")+MV_PAR02,"A1_NREDUZ")	cMail		:= Upper(Posicione("SA1",1,xFilial("SA1")+MV_PAR02,"A1_EMAIL"))	cCodProd 	:= alltrim(MV_PAR05)	cProduto	:= Posicione("SB1",1,xFilial("SB1")+cCodProd,"B1_DESC")	nQE			:= Posicione("SB1",1,xFilial("SB1")+cCodProd,"B1_QE")	cOP			:= MV_PAR07	cDun14		:= Posicione("SB5",1,xFilial("SB5")+cCodProd,"B5_DUN14")		If !empty(MV_PAR11)		cData := dToC(MV_PAR11)	EndIf	MSCBPRINTER("S500-8","LPT1",,40,.f.) 	//Setei Impressora Eltron pois OS 214 ou ARGOX ou ALLEGRO nao imprime nada.	MSCBCHKSTATUS(.F.) 						//status da impressora, se .F. imprime mesmo com problema de impressora, se .T. nao imprime	MSCBBEGIN(nQtdImp,6) 					//Quantidade de cópias	If !Empty(MV_PAR01) .AND. MV_PAR09 == 1 // Imprime LOGO e Codigo de Barras				//IMPRIME CODIGO DE BARRAS		cArq := alltrim(MV_PAR01)		MSCBLOADGRF("lgrl0101nPB.bmp") 		MSCBBEGIN(nQtdImp,6)		cFile := retFileName(cArq)		MSCBGRAFIC(2,3,"lgrl0101nPB")				nIni := 28		//IMPRIME CODIGO DE BARRAS		//MSCBSAYBAR(nIni,010,cValToChar(cDun14),"N","MB01",8.36,.F.,.T.,.F.,,2,1,.F.,.F.,"1",.T.)		MSCBSAYBAR(022,nIni,cValToChar(cDun14),"N","MB01",10,.F.,.T.,.F.,,4,2,.F.,.F.,"1",.T.)		nIni := 45	    		ElseIf !Empty(MV_PAR01) // só logo			nIni	:= 40		cArq := alltrim(MV_PAR01)		MSCBLOADGRF(cArq)     		MSCBBEGIN(nQtdImp,6)		MSCBGRAFIC(2,3,substr(cArq,1,len(cArq)-4))		     		ElseIf MV_PAR09 == 1 // Só Codigo de barra			nIni := 15		MSCBSAYBAR(022,nIni,cValToChar(cDun14),"N","MB01",10,.F.,.T.,.F.,,4,2,.F.,.F.,"1",.T.)			nIni := 35	Else //nenhum		nIni	:= 25	EndIf	// Impressões dos TEXTOS	If MV_PAR03 == 1 // Imprime Nome do Cliente		MSCBSAY(19,nIni,cCliente						,"N","0","034,034")	EndIf	If MV_PAR06 == 1 // Imprime código do Produto		MSCBSAY(13,nIni+5,cCodProd+""+cProduto			,"N","0","038")	Else		MSCBSAY(13,nIni+5,cProduto						,"N","0","038")	EndIf	MSCBSAY(22,nIni+10,"CONTEM"							,"N","0","030,030")	MSCBSAY(40,nIni+10,cValToChar(nQE)					,"N","0","038,038")	MSCBSAY(51,nIni+10,"UNIDADES"						,"N","0","030,030")	If MV_PAR04 == 1 // Imprime email do cliente		MSCBSAY(05,nIni+15,cMail			,"N","0","030")	EndIf	MSCBSAY(13,nIni+20,"Lote:" + cOP						,"N","0","038")	MSCBSAY(55,nIni+20,"Data:" + cData			,"N","0","038")	If MV_PAR08 == 1 // Imprime CNPJ		MSCBSAY(05,nIni+25,"Produzido Por: " + Transform(SM0->M0_CGC,"@R 99.999.999/9999-99")		,"N","0","030")	EndIf	MSCBSAY(03,nIni+29,"Em caso de nao conformidade no produto, por favor guardar a etiqueta"	,"N","0","24")	MSCBEND() //Fim da Imagem da Etiqueta	MSCBCLOSEPRINTER()ReturnStatic Function ValidPerg()	Local _sAlias := Alias()	Local aRegs := {}	Local i,j	DBSelectArea("SX1") ; DBSetOrder(1)	cPerg := PADR(cPerg,10)	AADD(aRegs,{cPerg,"01","Logo: "           		,"","","mv_ch1","C",50,0,0,"F","","mv_par01","56","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",{"Informe o Logo para a etiqueta"}})	AADD(aRegs,{cPerg,"02","Cliente:"				,"","","mv_ch2","C", 6,0,0,"G","","mv_par02","","","","","","","","","","","","","","","","","","","","","","","","","SA1"})	AADD(aRegs,{cPerg,"03","Impr. nome Cliente?"	,"","","mv_ch3","N",01,0,0,"C","","Mv_Par03","S=Sim","","","","","N=Nao","","","","","","","","","","","","","","","","","","","","","","","",""})	AADD(aRegs,{cPerg,"04","Impr. e-mail Cliente?"	,"","","mv_ch4","N",01,0,0,"C","","Mv_Par04","S=Sim","","","","","N=Nao","","","","","","","","","","","","","","","","","","","","","","","",""})	AADD(aRegs,{cperg,"05","Produto:"				,"","","mv_ch5","C",15,0,0,"G","","mv_par05","","","","","","","","","","","","","","","","","","","","","","","","","SB1"})	AADD(aRegs,{cPerg,"06","Impr. Cód. Produto?"	,"","","mv_ch6","N",01,0,0,"C","","Mv_Par06","S=Sim","","","","","N=Nao","","","","","","","","","","","","","","","","","","","","","","","",""})	AADD(aRegs,{cperg,"07","OP:"					,"","","mv_ch7","C", 6,0,0,"G","","mv_par07","","","","","","","","","","","","","","","","","","","","","","","","","SC2"})	AADD(aRegs,{cPerg,"08","Impr. CNPJ?"			,"","","mv_ch8","N",01,0,0,"C","","Mv_Par08","S=Sim","","","","","N=Nao","","","","","","","","","","","","","","","","","","","","","","","",""})	AADD(aRegs,{cPerg,"09","Impr. Cód. Barra?"		,"","","mv_ch09","N",01,0,0,"C","","Mv_Par09","S=Sim","","","","","N=Nao","","","","","","","","","","","","","","","","","","","","","","","",""})	AADD(aRegs,{cperg,"10","Quantidade:"			,"","","mv_ch10","C", 4,0,0,"G","","mv_par10","","","","","","","","","","","","","","","","","","","","","","","","",""})	AADD(aRegs,{cperg,"11","Data:"					,"","","mv_ch11","D", 8,0,0,"G","","mv_par11","","","","","","","","","","","","","","","","","","","","","","","","",""})	For i:=1 to Len(aRegs)		If !dbSeek(cPerg+aRegs[i,2])			RecLock("SX1",.T.)		Else			RecLock("SX1",.F.)		EndIf		For j:=1 to FCount()			If j <= Len(aRegs[i])				FieldPut(j,aRegs[i,j])			EndIf		Next		MsUnlock()		//EndIf	Next	DBSelectArea(_sAlias)Return