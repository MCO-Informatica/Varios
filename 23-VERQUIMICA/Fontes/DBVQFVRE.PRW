USER FUNCTION DBVQFVRE()
LOCAL _CSQL := ""                                 
LOCAL _NQTDREG := 0

DBSELECTAREA("SC5");DBSETORDER(1)

_CSQL += " SELECT SUA.UA_NUM, SUA.UA_NUMSC5, SUA.UA_VQ_FVRE, SUA.UA_EMISSAO, SC5.C5_NUM, SC5.C5_VQ_FVRE "
_CSQL += " FROM " +RETSQLNAME("SUA")+ " SUA INNER JOIN 	" +RETSQLNAME("SC5")+ " SC5 ON SC5.D_E_L_E_T_ <> '*' 	AND SC5.C5_NUM = SUA.UA_NUMSC5 "
_CSQL += " WHERE  SUA.D_E_L_E_T_ <> '*' AND SUA.UA_VQ_FVRE > 0 	AND SC5.C5_VQ_FVRE = 0  "
_CSQL += " ORDER BY UA_NUMSC5"
      
If Select("TRBFVRE") > 0
	TRBFVRE->( DBCLOSEAREA() )
Endif

_CSQL := CHANGEQUERY(_CSQL)
DBUSEAREA(.T.,"TOPCONN",TCGENQRY(,,_CSQL),"TRBFVRE",.T.,.T.)
DBSELECTAREA("TRBFVRE") 
PROCREGUA(RECCOUNT("TRBFVRE"))
DBGOTOP()                   

WHILE !EOF()
	INCPROC("PROCESSANDO PEDIDO: " + TRBFVRE->UA_NUMSC5)
	_NQTDREG += 1
	IF SC5->(DBSEEK(XFILIAL("SC5")+TRBFVRE->UA_NUMSC5))
		RECLOCK("SC5", .F.)
			SC5->C5_VQ_FVRE := TRBFVRE->UA_VQ_FVRE
		SC5->(MSUNLOCK())
	ENDIF	    
	TRBFVRE->(DBSKIP())
ENDDO            

MSGINFO("PROCESSO FINALIZADO ---- " + CVALTOCHAR(_NQTDREG) + " REGISTROS NA SC5 FORAM ALTERADOS") 
TRBFVRE->( DBCLOSEAREA() )
             
RETURN()